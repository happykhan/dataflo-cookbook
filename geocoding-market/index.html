
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Geocoding addresses">
      
      
      
      
        <link rel="prev" href="../about-dataflo/">
      
      
        <link rel="next" href="../login-workflow/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Converting addresses to latitude and longitude. - The Data-flo Cookbook</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-flo-features-demonstrated" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="The Data-flo Cookbook" class="md-header__button md-logo" aria-label="The Data-flo Cookbook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            The Data-flo Cookbook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Converting addresses to latitude and longitude.
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="The Data-flo Cookbook" class="md-nav__button md-logo" aria-label="The Data-flo Cookbook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    The Data-flo Cookbook
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to The Data-flo Cookbook
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about-dataflo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About Data-flo
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Converting addresses to latitude and longitude.
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Converting addresses to latitude and longitude.
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-flo-features-demonstrated" class="md-nav__link">
    <span class="md-ellipsis">
      Data-flo features demonstrated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-this-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      About this dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering-and-geocoding-street-addresses" class="md-nav__link">
    <span class="md-ellipsis">
      Filtering and geocoding street addresses
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../login-workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Login and create a new workflow
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../merging-two-sheets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Merging two datatables (Excel sheets)
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../removing-duplicates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Removing duplicates from a dataset
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../renaming-newick-files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Renaming labels in a Newick tree file
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#data-flo-features-demonstrated" class="md-nav__link">
    <span class="md-ellipsis">
      Data-flo features demonstrated
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#about-this-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      About this dataset
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#filtering-and-geocoding-street-addresses" class="md-nav__link">
    <span class="md-ellipsis">
      Filtering and geocoding street addresses
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Converting addresses to latitude and longitude.</h1>

<p><em>Prepared by Nabil-Fareed Alikhan. Last updated 2024-04-09</em></p>
<p>Converting geographic location information, like an address into a latitude and longitude is a common hurdle for displaying data points on a map. This also affects tools like <a href="https://microreact.org/">Microreact</a>. Data-flo includes a geocoding adaptor that 
can solve this problem at many levels of granuality. To illustrate this, this recipe uses a dataset that has the street address of farmers markets in the United States. We will aim to filter the data and present some of these on a map.</p>
<h2 id="data-flo-features-demonstrated">Data-flo features demonstrated</h2>
<ul>
<li>Merging columns with <code>concatenate-columns</code></li>
<li>Filtering rows with <code>filter-rows</code></li>
<li>Geocoding, converting addresses into latitude and longitude with <code>geocoding</code>  </li>
</ul>
<h2 id="about-this-dataset">About this dataset</h2>
<p>The dataset used here is not related to genomics, rather to Farmers Markets in the United States. These data are available as a <a href="https://www.kaggle.com/datasets/madeleineferguson/farmers-markets-in-the-united-states">dataset on Kaggle</a>. 
Farmers markets are an important way for citizens to eat healthy fresh food while supporting small family farms. This data contains information about all the registered farmers markets in the United States in 2020. This includes the city, county, and information about the types of food sold at each market. </p>
<p>You will need the following data: </p>
<ul>
<li><a href="../geocoding/farmers_markets_from_usda.csv">Data table</a></li>
</ul>
<h2 id="filtering-and-geocoding-street-addresses">Filtering and geocoding street addresses</h2>
<p>This can be acheived by using the following adaptors:</p>
<ul>
<li><code>import-from-csv-file</code> </li>
<li><code>concatenate-columns</code></li>
<li><code>filter-rows</code></li>
<li><code>geocoding</code> </li>
<li><code>export-to-csv-file</code> </li>
</ul>
<p>The workflow looks like this: </p>
<p><img alt="Existing df" src="../geocoding/workflow.png" /></p>
<p>My version of <a href="https://next.data-flo.io/run/5of1AvDj64QjP6RjFD1rsU-filter-and-geocode-example">this workflow is available here</a>. You are more than welcome to use this workflow for other data, or clone and alter it for your own needs.</p>
<p>To simplify the dataset, we will focus showing farmers markets in one US state, Vermont. This is done using the <code>filter-rows</code> adaptor with the settings below. </p>
<p><img alt="Existing df" src="../geocoding/filtering-state.png" /></p>
<p>To create a full address line in a single column, we use the <code>concatenate-columns</code> adaptor, taking the seperate columns like "Street", "City", "County" and converting that into a single column delimted time commas. That is: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Street  City    County
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>153 Rte 5   Hartland    Windsor
</code></pre></div>
<p>Is merged into:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>Location
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>153 Rte 5,Hartland,Windsor
</code></pre></div>
<p><img alt="Existing df" src="../geocoding/merging-columns.png" /></p>
<p>To make sure each market location has the same granuality, we add a filtering step with the <code>filter rows</code> adaptor to remove any rows that does not have a Street address.</p>
<p><img alt="Existing df" src="../geocoding/filtering-street.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Flexible geocoding</p>
<p>While this example uses a street addresses, the geocoding will work with less information, like with only city or country. The geocoding can also work with postcodes (e.g. CB22 3DQ) and landmarks (e.g. Big Ben)</p>
</div>
<p>The filtered table is passed to a <code>geocoding</code> adaptor for the actual geocoding. We previous created the "Location" field in the datatable, so we can set this as the location column for geocoding.</p>
<p><img alt="Existing df" src="../geocoding/geocoding.png" /></p>
<p>The output of this step is sent to a <code>export-to-csv-file</code> adaptor. This allows you to customise the final outfile, for instance, to set the output file name to be "geocoded_table.csv". The resulting file can be uploaded to <a href="https://microreact.org/upload">Microreact</a> for visualisation. The final map from this example is shown below. If you are unsure how to upload data to Microreact, please <a href="https://microreact-cookbook.netlify.app/basic-upload/">see the guide here</a>. </p>
<p><img alt="Existing df" src="../geocoding/microreact-map.png" /></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>